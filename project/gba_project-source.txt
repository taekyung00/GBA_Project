Directory: project
Files analyzed: 3

Estimated tokens: 3.9k

Directory structure:
â””â”€â”€ project/
    â”œâ”€â”€ include/
    â”‚   â”œâ”€â”€ fixed.h
    â”‚   â””â”€â”€ gba.h
    â””â”€â”€ src/
        â””â”€â”€ week2.c


================================================
FILE: include/fixed.h
================================================
#ifndef FIXED_H
#define FIXED_H

#include "gba.h" // u32, bool ë“± ê¸°ë³¸ íƒ€ì… ì‚¬ìš©ì„ ìœ„í•´ í¬í•¨

// =========================================================================
// ğŸ’¡ ê³ ì • ì†Œìˆ˜ì (Fixed Point) ë¼ì´ë¸ŒëŸ¬ë¦¬ (Q24.8 Format)
// -------------------------------------------------------------------------
//
// [1. ì™œ ì‚¬ìš©í•˜ëŠ”ê°€?]
//    GBA(ARM7TDMI)ì—ëŠ” ì‹¤ìˆ˜(float)ë¥¼ ê³„ì‚°í•˜ëŠ” í•˜ë“œì›¨ì–´(FPU)ê°€ ì—†ìŠµë‹ˆë‹¤.
//    floatë¥¼ ì“°ë©´ ì†Œí”„íŠ¸ì›¨ì–´ì ìœ¼ë¡œ ì—ë®¬ë ˆì´ì…˜í•˜ëŠë¼ ì†ë„ê°€ ìˆ˜ì‹­ ë°° ëŠë ¤ì§‘ë‹ˆë‹¤.
//    ë”°ë¼ì„œ "256ì„ ê³±í•œ ì •ìˆ˜"ë¥¼ ì‚¬ìš©í•˜ì—¬ ì†Œìˆ˜ì  ì—°ì‚°ì„ í‰ë‚´ ëƒ…ë‹ˆë‹¤.
//
// [2. í•˜ë“œì›¨ì–´ì˜ ê´€ì  (Hardware Agnostic)]
//    GBA í•˜ë“œì›¨ì–´(CPU, PPU)ëŠ” ì´ ê°’ì´ ê³ ì • ì†Œìˆ˜ì ì¸ì§€ ëª¨ë¦…ë‹ˆë‹¤.
//    ê·¸ëƒ¥ '256ë°° í° ì •ìˆ˜'ë¡œ ì·¨ê¸‰í•˜ì—¬ ë§ì…ˆ/ëº„ì…ˆì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.
//    ìš°ë¦¬ê°€ í™”ë©´(VRAM/OAM)ì— ê°’ì„ ë„˜ê¸¸ ë•Œë§Œ 'ì •ìˆ˜'ë¡œ í†µì—­í•´ì£¼ë©´ ë©ë‹ˆë‹¤.
//
// [3. ì‚¬ìš© ì›ì¹™ (The Two Worlds)]
//    - ë¬¼ë¦¬ ì„¸ê³„ (Physics): ìœ„ì¹˜(x,y), ì†ë„, ì¤‘ë ¥ ë“± ì›€ì§ì´ëŠ” ê°’ -> ë¬´ì¡°ê±´ 'fixed' ìœ ì§€
//    - ë…¼ë¦¬ ì„¸ê³„ (Logic): ì•„ì´í…œ ê°œìˆ˜, ì¸ë±ìŠ¤, íƒ€ì¼ ë²ˆí˜¸ -> ì¼ë°˜ 'int' ì‚¬ìš©
//    - ë Œë”ë§ (Render): ê·¸ë¦¬ê¸° ì§ì „ì— 'fixed' -> 'int'ë¡œ ë³€í™˜í•˜ì—¬ í•˜ë“œì›¨ì–´ì— ì „ë‹¬
//
// =========================================================================


// -------------------------------------------------------------------------
// 1. ì„¤ì • ìƒìˆ˜ (Configuration)
// -------------------------------------------------------------------------
#define FIX_SHIFT    8                // í•˜ìœ„ 8ë¹„íŠ¸ë¥¼ ì†Œìˆ˜ë¶€ë¡œ ì‚¬ìš©
#define FIX_SCALE    (1 << FIX_SHIFT) // 256 (1.0ì„ ì˜ë¯¸í•˜ëŠ” ì •ìˆ˜ ê°’)
#define FIX_MASK     (FIX_SCALE - 1)  // 0xFF (ì†Œìˆ˜ë¶€ ë¹„íŠ¸ ë§ˆìŠ¤í¬)
#define FIX_ONE      FIX_SCALE        // 1.0


// -------------------------------------------------------------------------
// 2. ìë£Œí˜• ì •ì˜ (Typedef)
// -------------------------------------------------------------------------
// intì™€ ê°™ì§€ë§Œ, "ì´ ë³€ìˆ˜ëŠ” 256ë°° íŠ€ê²¨ì§„ ê°’ì´ë‹¤"ë¼ê³  ëª…ì‹œí•˜ê¸° ìœ„í•´ ì‚¬ìš©í•©ë‹ˆë‹¤.
typedef int fixed;


// -------------------------------------------------------------------------
// 3. ë³€í™˜ ë§¤í¬ë¡œ (Conversion Macros)
// -------------------------------------------------------------------------

// [ì •ìˆ˜ -> ê³ ì • ì†Œìˆ˜ì ] (Enter Physics World)
// ì‚¬ìš©: ì´ˆê¸°ê°’ ì„¤ì •, ì •ìˆ˜ ë”í•˜ê¸°
// ì˜ˆ: INT_TO_FIX(10) -> 2560
#define INT_TO_FIX(n)    ((fixed)((n) << FIX_SHIFT))

// [ì‹¤ìˆ˜ -> ê³ ì • ì†Œìˆ˜ì ] (Data Import)
// ì‚¬ìš©: ë¬¼ë¦¬ ìƒìˆ˜ ì´ˆê¸°í™” (ì˜ˆ: ì¤‘ë ¥ 9.8, ë§ˆì°°ë ¥ 0.1)
// ì£¼ì˜: float ì—°ì‚°ì´ í¬í•¨ë˜ë¯€ë¡œ 'ì´ˆê¸°í™” ë‹¨ê³„'ì—ì„œë§Œ ì‚¬ìš©í•  ê²ƒ. ë£¨í”„ ë‚´ë¶€ ê¸ˆì§€.
#define FLOAT_TO_FIX(f)  ((fixed)((f) * (float)FIX_SCALE))

// [ê³ ì • ì†Œìˆ˜ì  -> ì •ìˆ˜ (ë²„ë¦¼)] (Render to Hardware)
// ì‚¬ìš©: ìµœì¢…ì ìœ¼ë¡œ í™”ë©´(VRAM)ì— ì¢Œí‘œë¥¼ ì°ì„ ë•Œ
// ì˜ˆ: 2560(10.0) -> 10, 2688(10.5) -> 10
#define FIX_TO_INT(n)    ((n) >> FIX_SHIFT)

// [ê³ ì • ì†Œìˆ˜ì  -> ì •ìˆ˜ (ë°˜ì˜¬ë¦¼)] (Render Precise)
// ì‚¬ìš©: ë” ì •í™•í•œ ì¢Œí‘œê°€ í•„ìš”í•  ë•Œ
// ì˜ˆ: 10.5 -> 11, 10.4 -> 10
#define FIX_ROUND(n)     (((n) + (FIX_SCALE / 2)) >> FIX_SHIFT)

// [ê³ ì • ì†Œìˆ˜ì  -> ì‹¤ìˆ˜] (Debugging)
// ì‚¬ìš©: printf ë“±ìœ¼ë¡œ ê°’ì„ í™•ì¸í•˜ê³  ì‹¶ì„ ë•Œ
// ì£¼ì˜: ì ˆëŒ€ ê²Œì„ ë¡œì§ì´ë‚˜ ì—°ì‚°ìš©ìœ¼ë¡œ ì‚¬ìš©í•˜ì§€ ë§ ê²ƒ (ë§¤ìš° ëŠë¦¼).
#define FIX_TO_FLOAT(n)  ((float)(n) / (float)FIX_SCALE)


// -------------------------------------------------------------------------
// 4. ì‚°ìˆ  ì—°ì‚° í•¨ìˆ˜ (Arithmetic Functions)
// -------------------------------------------------------------------------

// [ë§ì…ˆ/ëº„ì…ˆ]
// ê·¸ëƒ¥ + - ì—°ì‚°ìë¥¼ ì‚¬ìš©í•˜ë©´ ë©ë‹ˆë‹¤. (ë¹„íŠ¸ ì´ë™ í•„ìš” ì—†ìŒ)
// fixed c = a + b;


// [ê³±ì…ˆ]
// ì›ë¦¬: (A * 256) * (B * 256) = (A * B) * 65536
// ê²°ê³¼ê°€ 256^2ë°°ê°€ ë˜ë¯€ë¡œ, ë‹¤ì‹œ 256(SHIFT)ìœ¼ë¡œ ë‚˜ëˆ ì¤˜ì•¼ ì›ë˜ ìŠ¤ì¼€ì¼ë¡œ ëŒì•„ì˜´.
// (long long) ìºìŠ¤íŒ…: 32ë¹„íŠ¸ë¼ë¦¬ ê³±í•˜ë©´ ì˜¤ë²„í”Œë¡œìš°ê°€ ë°œìƒí•  ìˆ˜ ìˆì–´ 64ë¹„íŠ¸ë¡œ í™•ì¥.
static inline fixed fix_mul(fixed a, fixed b) {
    return (fixed)(((long long)a * b) >> FIX_SHIFT);
}

// [ë‚˜ëˆ—ì…ˆ]
// ì›ë¦¬: (A * 256) / (B * 256) = A / B (ìŠ¤ì¼€ì¼ ì†Œì‹¤ë¨)
// ë¯¸ë¦¬ Aì— 256ì„ í•œë²ˆ ë” ê³±í•´ë†“ê³  ë‚˜ëˆ ì•¼ ìŠ¤ì¼€ì¼(256ë°°)ì´ ìœ ì§€ë¨.
static inline fixed fix_div(fixed a, fixed b) {
    return (fixed)(((long long)a << FIX_SHIFT) / b);
}

// [ì ˆëŒ“ê°’]
static inline fixed fix_abs(fixed a) {
    return (a < 0) ? -a : a;
}

// [ìµœì†Œê°’]
static inline fixed fix_min(fixed a, fixed b) {
    return (a < b) ? a : b;
}

// [ìµœëŒ€ê°’]
static inline fixed fix_max(fixed a, fixed b) {
    return (a > b) ? a : b;
}

#endif // FIXED_H


================================================
FILE: include/gba.h
================================================
#ifndef GBA_H
#define GBA_H

// =========================================================================
// 1. ê¸°ë³¸ ìë£Œí˜• (Primitive Types)
// -------------------------------------------------------------------------
// GBA(ARM7TDMI)ëŠ” 32ë¹„íŠ¸ RISC CPUì…ë‹ˆë‹¤.
// Cì–¸ì–´ì˜ 'int' í¬ê¸°ëŠ” ì»´íŒŒì¼ëŸ¬ë§ˆë‹¤ ë‹¤ë¥¼ ìˆ˜ ìˆìœ¼ë¯€ë¡œ, 
// í•˜ë“œì›¨ì–´ ë¹„íŠ¸ ìˆ˜ì— ë”± ë§ëŠ” ëª…ì‹œì ì¸ íƒ€ì…ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ í‘œì¤€ì…ë‹ˆë‹¤.
// =========================================================================

#include <stdbool.h> // í‘œì¤€ bool, true, false ì‚¬ìš© (C99/C23 í˜¸í™˜)
#include <stddef.h>  // í‘œì¤€ NULL ì‚¬ìš©

typedef unsigned char  u8;  // 8ë¹„íŠ¸ (1ë°”ì´íŠ¸): íƒ€ì¼ ì¸ë±ìŠ¤, ì‘ì€ ì •ìˆ˜ ë“±
typedef unsigned short u16; // 16ë¹„íŠ¸ (2ë°”ì´íŠ¸): ìƒ‰ìƒ(RGB555), ë ˆì§€ìŠ¤í„° ì œì–´ ë“± ì£¼ë ¥ íƒ€ì…
typedef unsigned int   u32; // 32ë¹„íŠ¸ (4ë°”ì´íŠ¸): ë©”ëª¨ë¦¬ ì£¼ì†Œ, í° ë°ì´í„°, DMA ì „ì†¡ ì‹œ ì‚¬ìš©


// =========================================================================
// 2. ë©”ëª¨ë¦¬ ë§µ (Memory Map)
// -------------------------------------------------------------------------
// GBAëŠ” OSê°€ ì—†ìŠµë‹ˆë‹¤. íŠ¹ì • ë©”ëª¨ë¦¬ ì£¼ì†Œì— ê°’ì„ ì“°ë©´ í•˜ë“œì›¨ì–´ê°€ ì¦‰ì‹œ ë°˜ì‘í•©ë‹ˆë‹¤.
// ì´ë¥¼ Memory Mapped I/O (MMIO)ë¼ê³  í•©ë‹ˆë‹¤.
// =========================================================================

#define REG_BASE        0x04000000 // I/O ë ˆì§€ìŠ¤í„°ë“¤ì˜ ì‹œì‘ ì£¼ì†Œ
#define VRAM_BASE       0x06000000 // ë¹„ë””ì˜¤ ë©”ëª¨ë¦¬(í™”ë©´ ë°ì´í„°) ì‹œì‘ ì£¼ì†Œ

// VRAM í¬ì¸í„°
// u16 í¬ì¸í„°ì¸ ì´ìœ : VRAMì€ ë³´í†µ 16ë¹„íŠ¸(ìƒ‰ìƒ ê°’) ë‹¨ìœ„ë¡œ ì½ê³  ì“°ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.
// volatile í•„ìˆ˜: ì»´íŒŒì¼ëŸ¬ê°€ "ì•„ê¹Œ ì¼ìœ¼ë‹ˆê¹Œ ì•ˆ ì¨ë„ ë˜ê² ì§€?"ë¼ê³  ìµœì í™”í•˜ëŠ” ê²ƒì„ ë§‰ìŠµë‹ˆë‹¤.
#define VRAM            ((volatile u16*)VRAM_BASE)

// =========================================================================
// 3. í•˜ë“œì›¨ì–´ ë ˆì§€ìŠ¤í„° (Hardware Registers)
// -------------------------------------------------------------------------
// ì£¼ì†Œ ì•ì— *(volatile íƒ€ì… *)ì„ ë¶™ì´ëŠ” ì´ìœ :
// 1. (volatile íƒ€ì… *): ì •ìˆ˜ ìˆ«ìë¥¼ 'í¬ì¸í„°(ì£¼ì†Œ)'ë¡œ ì·¨ê¸‰í•´ë¼.
// 2. *: ê·¸ í¬ì¸í„°ê°€ ê°€ë¦¬í‚¤ëŠ” ì‹¤ì œ 'ê°’'ì„ ê°€ì ¸ì˜¤ê±°ë‚˜ ìˆ˜ì •í•´ë¼ (Dereference).
// =========================================================================

// [ë””ìŠ¤í”Œë ˆì´ ì œì–´]
// ì£¼ì†Œ: 0x04000000
// íƒ€ì…: u32 (ë³¸ë˜ u16ì´ì§€ë§Œ, 32ë¹„íŠ¸ ë²„ìŠ¤ íš¨ìœ¨ì„ ìœ„í•´ u32ë¡œ ì ‘ê·¼í•˜ê¸°ë„ í•¨)
// ì—­í• : í™”ë©´ ëª¨ë“œ(0~5), ë°°ê²½ í™œì„±í™”, ìŠ¤í”„ë¼ì´íŠ¸ í™œì„±í™” ë“± ì´ê´„ ì„¤ì •
#define REG_DISPCNT     (*(volatile u32*)(REG_BASE + 0x0000))

// [ìˆ˜ì§ ë¼ì¸ ì¹´ìš´í„° (Scanline Counter)]
// ì£¼ì†Œ: 0x04000006
// íƒ€ì…: u16 (0~227 ë²”ìœ„)
// ì—­í• : í˜„ì¬ ì „ìì´ì´ ê·¸ë¦¬ê³  ìˆëŠ” ê°€ë¡œì¤„ ë²ˆí˜¸ë¥¼ ì½ìŒ (Read-Only). VSync êµ¬í˜„ì˜ í•µì‹¬.
#define REG_VCOUNT      (*(volatile u16*)(REG_BASE + 0x0006))

// [í‚¤ ì…ë ¥ ìƒíƒœ]
// ì£¼ì†Œ: 0x04000130
// íƒ€ì…: u16 (ì´ 10ê°œ ë²„íŠ¼ì´ë¯€ë¡œ 10ë¹„íŠ¸ ì‚¬ìš©)
// ì—­í• : ë²„íŠ¼ì´ ëˆŒë ¸ëŠ”ì§€ í™•ì¸. (ì£¼ì˜: ëˆŒë¦¬ë©´ 0, ì•ˆ ëˆŒë¦¬ë©´ 1 -> Active Low)
#define REG_KEYINPUT    (*(volatile u16*)(REG_BASE + 0x0130))

// =========================================================================
// 4. ì„¤ì • ìƒìˆ˜ (Configuration Constants)
// =========================================================================

// í™”ë©´ í¬ê¸° (ë¬¼ë¦¬ì  í•´ìƒë„ ê³ ì •)
#define SCREEN_W        240
#define SCREEN_H        160

// ë””ìŠ¤í”Œë ˆì´ ëª¨ë“œ ì„¤ì • ë¹„íŠ¸
// REG_DISPCNTì— OR(|) ì—°ì‚°ìœ¼ë¡œ ì„¤ì •í•¨
#define MODE_3          0x0003 // ë¹„íŠ¸ë§µ ëª¨ë“œ (240x160, íŠ¸ë£¨ì»¬ëŸ¬)
#define BG2_ENABLE      0x0400 // ë°°ê²½ ë ˆì´ì–´ 2 ì¼œê¸° (Mode 3ëŠ” BG2ë¥¼ ì‚¬ìš©í•¨)

// =========================================================================
// 5. ìƒ‰ìƒ ë§¤í¬ë¡œ (Color Macros)
// -------------------------------------------------------------------------
// GBAëŠ” 15ë¹„íŠ¸ ìƒ‰ìƒ(BGR555)ì„ ì‚¬ìš©í•©ë‹ˆë‹¤. 
// í¬ë§·: XBBBBBGGGGGRRRRR (MSB 1ë¹„íŠ¸ëŠ” ì‚¬ìš© ì•ˆ í•¨)
// ê° ì±„ë„ ë²”ìœ„: 0 ~ 31
// =========================================================================

#define RGB(r, g, b)    ((u16)((r) | ((g) << 5) | ((b) << 10)))

#define COLOR_BLACK     RGB(0,  0,  0)
#define COLOR_WHITE     RGB(31, 31, 31)
#define COLOR_RED       RGB(31, 0,  0)
#define COLOR_GREEN     RGB(0,  31, 0)
#define COLOR_BLUE      RGB(0,  0,  31)
#define COLOR_GOLD      RGB(31, 25, 0)
#define COLOR_CYAN      RGB(0,  31, 31)
#define COLOR_MAGENTA   RGB(31, 0,  31)

// =========================================================================
// 6. í‚¤ ë§ˆìŠ¤í¬ (Input Key Masks)
// -------------------------------------------------------------------------
// REG_KEYINPUTì˜ íŠ¹ì • ë¹„íŠ¸ë§Œ ì™ ë½‘ì•„ë‚´ê¸° ìœ„í•œ í•„í„°(Mask)ì…ë‹ˆë‹¤.
// =========================================================================

#define KEY_A           0x0001 // 0ë²ˆ ë¹„íŠ¸
#define KEY_B           0x0002 // 1ë²ˆ ë¹„íŠ¸
#define KEY_SELECT      0x0004 // 2ë²ˆ ë¹„íŠ¸
#define KEY_START       0x0008 // 3ë²ˆ ë¹„íŠ¸
#define KEY_RIGHT       0x0010 // 4ë²ˆ ë¹„íŠ¸
#define KEY_LEFT        0x0020 // 5ë²ˆ ë¹„íŠ¸
#define KEY_UP          0x0040 // 6ë²ˆ ë¹„íŠ¸
#define KEY_DOWN        0x0080 // 7ë²ˆ ë¹„íŠ¸
#define KEY_R           0x0100 // 8ë²ˆ ë¹„íŠ¸
#define KEY_L           0x0200 // 9ë²ˆ ë¹„íŠ¸

// =========================================================================
// 7. ì¸ë¼ì¸ ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ (Inline Utilities)
// -------------------------------------------------------------------------
// 'static inline'ì„ ì“°ë©´ í•¨ìˆ˜ í˜¸ì¶œ ì˜¤ë²„í—¤ë“œ ì—†ì´ ì½”ë“œê°€ ê·¸ ìë¦¬ì— ë³µì‚¬ë©ë‹ˆë‹¤.
// í—¤ë” íŒŒì¼ì— êµ¬í˜„í•  ë•Œ ê°€ì¥ ì¢‹ì€ ë°©ë²•ì…ë‹ˆë‹¤.
// =========================================================================

// VSync ëŒ€ê¸° í•¨ìˆ˜
// 1. í˜„ì¬ VBlank ì¤‘(í™”ë©´ ë°–)ì´ë¼ë©´ ë‹¤ìŒ í”„ë ˆì„ê¹Œì§€ ê¸°ë‹¤ë¦¼ (REG_VCOUNT >= 160)
// 2. í™”ë©´ì„ ê·¸ë¦¬ëŠ” ì¤‘ì´ë¼ë©´, ë‹¤ ê·¸ë¦´ ë•Œê¹Œì§€(160ì¤„ì´ ë  ë•Œê¹Œì§€) ê¸°ë‹¤ë¦¼
static inline void sync_vblank() {
    while (REG_VCOUNT >= 160); // VBlank ì¤‘ì´ë©´ ëŒ€ê¸°
    while (REG_VCOUNT < 160);  // VDraw ì¤‘ì´ë©´ ëŒ€ê¸°
}

#endif


================================================
FILE: src/week2.c
================================================
// =========================================================================
// GBA Engine Core: Week 2 Implementation
// -------------------------------------------------------------------------
// CS200 ê°œë… ë§¤í•‘:
// 1. Window Init -> REG_DISPCNT ì„¤ì •
// 2. Input -> REG_KEYINPUT í´ë§
// 3. Math -> Fixed Point ì—°ì‚°
// 4. Render -> VRAM ì§ì ‘ ì ‘ê·¼ (Software Rasterizer ê¸°ì´ˆ)
// =========================================================================

#include "../include/fixed.h"  // ê³ ì • ì†Œìˆ˜ì  ìˆ˜í•™ ë¼ì´ë¸ŒëŸ¬ë¦¬
#include "../include/gba.h"	   // í•˜ë“œì›¨ì–´ ë ˆì§€ìŠ¤í„° ë° íƒ€ì…

#define player_w 16
#define player_h 16

// -------------------------------------------------------------------------
// ë°ì´í„° êµ¬ì¡° (Data Structure)
// -------------------------------------------------------------------------
// CS200ì˜ VAO/VBO ëŒ€ì‹  êµ¬ì¡°ì²´ë¥¼ ì‚¬ìš©í•˜ì—¬ ë°ì´í„°ë¥¼ ì •ì˜í•©ë‹ˆë‹¤.
typedef struct {
	fixed x, y;	 // ë¬¼ë¦¬ ì¢Œí‘œ (ê³ ì • ì†Œìˆ˜ì )
	u16 color;	 // ìƒ‰ìƒ ë°ì´í„°
} Vertex;

// -------------------------------------------------------------------------
// ë Œë”ë§ í•¨ìˆ˜ (Renderer)
// -------------------------------------------------------------------------

// í™”ë©´ ì „ì²´ ì§€ìš°ê¸°
void clear_screen(u16 color) {
	// VRAMì€ 1ì°¨ì› ë°°ì—´ì²˜ëŸ¼ ì ‘ê·¼ ê°€ëŠ¥í•©ë‹ˆë‹¤.
	for (int i = 0; i < SCREEN_W * SCREEN_H; ++i) {
		VRAM[i] = color;
	}
}

// ì‚¬ê°í˜• ê·¸ë¦¬ê¸° (Software Rasterizer)
// ë¬¼ë¦¬ ì¢Œí‘œ(Fixed)ë¥¼ ë°›ì•„ì„œ í™”ë©´ ì¢Œí‘œ(Int)ë¡œ ë³€í™˜í•´ ê·¸ë¦½ë‹ˆë‹¤.
void draw_rect(fixed fx, fixed fy, int w, int h, u16 color) {
	// [Rendering Stage]: Fixed -> Int ë³€í™˜ (í•˜ë“œì›¨ì–´ëŠ” ê³ ì • ì†Œìˆ˜ì ì„ ëª¨ë¦„)
	int x = FIX_TO_INT(fx);	 //
	int y = FIX_TO_INT(fy);

	for (int row = 0; row < h; ++row) {
		for (int col = 0; col < w; ++col) {
			int draw_x = x + col;
			int draw_y = y + row;

			// í™”ë©´ ë²”ìœ„ ì²´í¬ (Clipping)
			if (draw_x >= 0 && draw_x < SCREEN_W && draw_y >= 0 && draw_y < SCREEN_H) {
				VRAM[draw_y * SCREEN_W + draw_x] = color;
			}
		}
	}
}

// -------------------------------------------------------------------------
// ë©”ì¸ ê²Œì„ ë£¨í”„ (Game Loop)
// -------------------------------------------------------------------------
int main() {
	// [1. Window Initialization]
	// OSê°€ ì—†ìœ¼ë¯€ë¡œ í•˜ë“œì›¨ì–´ ë ˆì§€ìŠ¤í„°ë¥¼ ì§ì ‘ ì„¤ì •í•˜ì—¬ í™”ë©´ ëª¨ë“œë¥¼ ì¼­ë‹ˆë‹¤.
	REG_DISPCNT = MODE_3 | BG2_ENABLE;

	// [2. Data Initialization]
	// ì •ìˆ˜ë¥¼ ê³ ì • ì†Œìˆ˜ì ìœ¼ë¡œ ë³€í™˜í•˜ì—¬ ë¬¼ë¦¬ ì„¸ê³„ë¡œ ì§„ì…í•©ë‹ˆë‹¤.

	Vertex player = {
		INT_TO_FIX(SCREEN_W / 2 - player_w / 2),  // í™”ë©´ ì¤‘ì•™ (x)
		INT_TO_FIX(SCREEN_H / 2 - player_h / 2),  // í™”ë©´ ì¤‘ì•™ (y)
		COLOR_BLUE};

	fixed speed = INT_TO_FIX(2);  // ì´ë™ ì†ë„: 2.0 pixel/frame

    // ì´ˆê¸° í”Œë ˆì´ì–´ ë Œë”ë§
    draw_rect(player.x, player.y, player_w, player_h, player.color);
	// ë¬´í•œ ë£¨í”„ (OSë¡œ ë³µê·€í•˜ì§€ ì•ŠìŒ)
	while (1) {
		// -------------------------------------------------
		// [Step 1] Input & Update (Physics World)
		// -------------------------------------------------

		// ì”ìƒ ì²˜ë¦¬ë¥¼ ìœ„í•´ ì´ë™ ì „ ì¢Œí‘œ ê¸°ì–µ
		fixed old_x = player.x;
		fixed old_y = player.y;

		// í‚¤ ì…ë ¥ ë ˆì§€ìŠ¤í„° ì½ê¸° (Active Low: ëˆ„ë¥´ë©´ 0)
		u16 keys = REG_KEYINPUT;

		// ê³ ì • ì†Œìˆ˜ì  ì—°ì‚°ìœ¼ë¡œ ì¢Œí‘œ ê°±ì‹ 
		if (!(keys & KEY_UP)) player.y -= speed;
		if (!(keys & KEY_DOWN)) player.y += speed;
		if (!(keys & KEY_LEFT)) player.x -= speed;
		if (!(keys & KEY_RIGHT)) player.x += speed;

		// -------------------------------------------------
		// [Step 2] Sync (Timing)
		// -------------------------------------------------
		// VBlank(í™”ë©´ ê·¸ë¦¬ê¸° íœ´ì‹ ì‹œê°„)ë¥¼ ê¸°ë‹¤ë¦½ë‹ˆë‹¤.
		sync_vblank();

		// -------------------------------------------------
		// [Step 3] Render (Visual World)
		// -------------------------------------------------

		// 1. í™”ë©´ ì§€ìš°ê¸° (ë°°ê²½ìƒ‰)
		// clear_screen(COLOR_BLACK);

		// 2. í”Œë ˆì´ì–´ ê·¸ë¦¬ê¸°
		// ì´ ì‹œì ì— Fixed -> Int ë³€í™˜ì´ ì¼ì–´ë‚©ë‹ˆë‹¤.
        // [ë”í‹° ë ‰íƒ±ê¸€ (Dirty Rectangle)]
        // í™”ë©´ ì „ì²´ë¥¼ ì§€ìš°ì§€ ì•Šê³ , ì›€ì§ì„ì´ ë°œìƒí•œ ë¶€ë¶„ë§Œ ìˆ˜ì •í•¨.
		if (old_x != player.x || old_y != player.y) {
			// ì´ì „ ìœ„ì¹˜ë¥¼ ê²€ì€ìƒ‰ìœ¼ë¡œ ì§€ì›Œ ì”ìƒ ì œê±°
			draw_rect(old_x, old_y, player_w, player_h, COLOR_BLACK);
            // ìƒˆë¡œìš´ ìœ„ì¹˜ì— í”Œë ˆì´ì–´ ê·¸ë¦¬ê¸°
            draw_rect(player.x, player.y, player_w, player_h, player.color);
		}
	}

	return 0;
}

